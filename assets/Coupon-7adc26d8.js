import{P as E,D as L}from"./DeleteModal-9168f066.js";import{M as P}from"./index-9908806f.js";import{b as v,s as M,_ as k,o as r,e as p,f as e,l as d,v as h,A as $,t as c,i as m,F as _,k as I,g,r as b,j as A,n as U}from"./index-d366a128.js";import{s as V}from"./swal-3e866175.js";const{VITE_API:x,VITE_PATH:w}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"metaverspace",BASE_URL:"/MetaverSpace",MODE:"production",DEV:!1,PROD:!0,SSR:!1},S={props:["page"],mixins:[V],data(){return{isNew:!0,tempCoupon:{},dueDate:""}},methods:{openModal(s,o){let l=new Date;s==="new"?(this.isNew=!0,this.tempCoupon={is_enabled:0},this.couponModal.show()):(this.isNew=!1,this.tempCoupon={...o},l=new Date(this.tempCoupon.due_date*1e3),this.couponModal.show()),this.dueDate=`${l.getFullYear()}-${("0"+(l.getMonth()+1)).slice(-2)}-${("0"+l.getDate()).slice(-2)}`,this.$refs.couponModal.scrollTop=0},updateCoupon(){let s="post",o=`${x}/api/${w}/admin/coupon`;this.isNew||(s="put",o=`${x}/api/${w}/admin/coupon/${this.tempCoupon.id}`),this.loadings.fullLoading=!0,this.$http[s](o,{data:this.tempCoupon}).then(()=>{this.$emit("updateCoupons",this.page,"update"),this.couponModal.hide()}).catch(l=>{this.adminToast("error",l.response.data.message)})}},computed:{...v(M,["loadings"])},watch:{dueDate(){this.tempCoupon.due_date=Math.floor(new Date(this.dueDate)/1e3)},"tempCoupon.percent"(){(this.tempCoupon.percent<1||this.tempCoupon.percent>99)&&(this.tempCoupon.percent=null)}},mounted(){const s={placement:"center",backdrop:"static",backdropClasses:"bg-black bg-opacity-80 fixed inset-0 z-30",closable:!0};this.couponModal=new P(this.$refs.couponModal,s)}},O={ref:"couponModal",id:"couponModal",tabindex:"-1",class:"hidden fixed z-40 w-full px-4 overflow-x-hidden overflow-y-auto top-28 left-0 right-0 h-auto"},j={class:"w-full max-w-xl h-full max-h-[calc(100vh-8.5rem)]"},N={class:"bg-white shadow rounded-lg overflow-hidden"},z={class:"flex items-start justify-between p-4 border-b bg-black top-[6rem] w-[calc(100%-2rem)] max-w-xl z-50 rounded-t-lg fixed"},B=e("h3",{class:"text-xl font-semibold text-gray-300"},"編輯優惠券",-1),H=e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1),R=[H],q={class:"p-6 mt-12"},F={class:"w-full max-w-md mx-auto space-y-6"},Y=e("label",{for:"name",class:"block mb-2 font-medium"},[m("優惠券名稱"),e("span",{class:"font-bold text-rose-500"},"*")],-1),G=e("label",{for:"coupon",class:"block mb-2 font-medium"},[m("折扣碼"),e("span",{class:"font-bold text-rose-500"},"*")],-1),J={class:"grid grid-cols-3 gap-6"},K={class:"col-span-2"},Q=e("label",{for:"date",class:"block mb-2 font-medium"},[m("到期日"),e("span",{class:"font-bold text-rose-500"},"*")],-1),W=e("label",{for:"percent",class:"block mb-2 font-medium"},[m("折扣百分比"),e("span",{class:"font-bold text-rose-500"},"*")],-1),X={class:"flex justify-between items-center"},Z=e("span",{class:"ml-2"},"%",-1),ee={class:"flex justify-between items-center"},te={class:"flex"},oe={class:"relative inline-flex items-center cursor-pointer"},se=["checked"],ne=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-teal-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-600"},null,-1),ae={class:"ml-3 text-md font-medium text-gray-900"},le={class:"flex justify-end"},ie=["disabled","title"];function de(s,o,l,f,t,i){return r(),p("div",O,[e("div",j,[e("div",N,[e("div",z,[B,e("button",{type:"button",class:"text-gray-400 bg-transparent hover:bg-gray-600 hover:text-white rounded-lg text-sm p-1.5 ml-auto inline-flex items-center",onClick:o[0]||(o[0]=a=>s.couponModal.hide())},R)]),e("div",q,[e("div",F,[e("div",null,[Y,d(e("input",{type:"text",id:"name",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 w-full p-2.5",required:"","onUpdate:modelValue":o[1]||(o[1]=a=>t.tempCoupon.title=a)},null,512),[[h,t.tempCoupon.title]])]),e("div",null,[G,d(e("input",{type:"text",id:"coupon",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 w-full p-2.5",required:"","onUpdate:modelValue":o[2]||(o[2]=a=>t.tempCoupon.code=a)},null,512),[[h,t.tempCoupon.code]])]),e("div",J,[e("div",K,[Q,d(e("input",{type:"date",id:"date",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 w-full p-2.5",required:"",onkeypress:"return false","onUpdate:modelValue":o[3]||(o[3]=a=>t.dueDate=a)},null,512),[[h,t.dueDate]])]),e("div",null,[W,e("div",X,[d(e("input",{type:"number",id:"percent",class:"text-end bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 w-full p-2.5",min:"1",max:"99",placeholder:"請輸入 1 ~ 99",required:"","onUpdate:modelValue":o[4]||(o[4]=a=>t.tempCoupon.percent=a)},null,512),[[h,t.tempCoupon.percent]]),Z])])]),e("div",ee,[e("div",te,[e("label",oe,[d(e("input",{type:"checkbox",class:"sr-only peer","true-value":1,"false-value":0,checked:t.tempCoupon.is_enabled,"onUpdate:modelValue":o[5]||(o[5]=a=>t.tempCoupon.is_enabled=a)},null,8,se),[[$,t.tempCoupon.is_enabled]]),ne,e("span",ae,c(t.tempCoupon.is_enabled?"已啟用":"未啟用"),1)])]),e("div",le,[e("button",{type:"button",class:"admin-delete-button",onClick:o[6]||(o[6]=a=>s.couponModal.hide())}," 取消 "),e("button",{type:"button",class:"ml-6 admin-primary-button",disabled:!t.tempCoupon.title||!t.tempCoupon.code||!t.tempCoupon.due_date||!t.tempCoupon.percent,title:[!t.tempCoupon.title||!t.tempCoupon.code||!t.tempCoupon.due_date||!t.tempCoupon.percent?'"*"號為必填欄位':""],onClick:o[7]||(o[7]=a=>i.updateCoupon())}," 確認 ",8,ie)])])])])])])],512)}const re=k(S,[["render",de]]),{VITE_API:y,VITE_PATH:C}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"metaverspace",BASE_URL:"/MetaverSpace",MODE:"production",DEV:!1,PROD:!0,SSR:!1},pe={mixins:[V],data(){return{coupons:[],pagination:{},couponLoading:[]}},methods:{getCoupons(s=1,o){this.loadings.fullLoading=!0,this.$http.get(`${y}/api/${C}/admin/coupons?page=${s}`).then(l=>{const{coupons:f,pagination:t}=l.data;this.coupons=f,this.pagination=t,this.loadings.fullLoading=!1,o==="update"?this.adminToast("success","已更新優惠券資料"):o==="delete"&&this.adminToast("success","已刪除優惠券資料")}).catch(l=>{this.loadings.fullLoading=!1,this.adminToast("error",l.response.data.message)})},updateEnable(s){this.couponLoading.push(s.id),this.$http.put(`${y}/api/${C}/admin/coupon/${s.id}`,{data:s}).then(()=>{this.couponLoading.shift(),this.adminToast("success","已更新啟用狀態")}).catch(o=>{this.couponLoading.shift(),this.adminToast("error",o.response.data.message),this.getCoupons(this.page.current_page)})}},computed:{...v(M,["loadings"])},mounted(){this.couponModal=this.$refs.couponModal,this.deleteModal=this.$refs.deleteModal,this.getCoupons()},components:{Pagination:E,CouponModal:re,DeleteModal:L}},ce={class:"mt-8 px-6"},ue={class:"mt-6 relative overflow-x-auto shadow-md sm:rounded-lg"},he={class:"w-full text-md text-left text-gray-700"},me=e("thead",{class:"text-sm text-dark uppercase bg-gray-300"},[e("tr",null,[e("th",{scope:"col",class:"sr-only"},"Loading"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"啟用"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"優惠券名稱"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"折扣碼"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"到期日"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"折扣百分比"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},[e("span",{class:"sr-only"},"選項")])])],-1),fe={class:"px-3 w-6 max-w-[1.5rem]"},ge={key:0,class:"animate-spin h-5 w-5 mr-3 text-dark",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},be=e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),_e=e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1),xe=[be,_e],we={class:"px-6 font-medium whitespace-nowrap"},ye={class:"w-9"},Ce=["disabled","checked","onUpdate:modelValue","onChange"],ve=e("div",{class:"w-full h-5 bg-gray-500 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-teal-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all border-gray-300 peer-checked:bg-teal-600"},null,-1),Me={class:"px-6 py-4 whitespace-nowrap"},ke={class:"px-6 py-4 whitespace-nowrap"},$e={class:"px-6 py-4 whitespace-nowrap"},Ve={scope:"col",class:"px-6 py-3 whitespace-nowrap"},Te={class:"px-6 py-4 whitespace-nowrap flex justify-center space-x-6"},De=["disabled","onClick"],Ee=["disabled","onClick"];function Le(s,o,l,f,t,i){const a=b("Pagination"),T=b("CouponModal"),D=b("DeleteModal");return r(),p(_,null,[e("div",ce,[e("button",{type:"button",class:"admin-primary-button",onClick:o[0]||(o[0]=n=>s.couponModal.openModal("new"))}," 新增優惠券 "),e("div",ue,[e("table",he,[me,e("tbody",null,[(r(!0),p(_,null,I(t.coupons,n=>(r(),p("tr",{class:"bg-white border-b hover:bg-teal-100",key:n.id},[e("td",fe,[t.couponLoading.indexOf(n.id)>-1?(r(),p("svg",ge,xe)):A("",!0)]),e("td",we,[e("div",ye,[e("label",{class:U(["relative",t.couponLoading.indexOf(n.id)>-1?"cursor-not-allowed":"cursor-pointer"])},[d(e("input",{type:"checkbox",class:"sr-only peer disabled:ring-4","true-value":1,"false-value":0,disabled:t.couponLoading.indexOf(n.id)>-1,checked:n.is_enabled,"onUpdate:modelValue":u=>n.is_enabled=u,onChange:u=>i.updateEnable(n)},null,40,Ce),[[$,n.is_enabled]]),ve],2)])]),e("td",Me,c(n.title),1),e("td",ke,c(n.code),1),e("td",$e,c(s.$filters.date(n.due_date)),1),e("td",Ve,c(n.percent)+"% ",1),e("td",Te,[e("button",{type:"button",disabled:t.couponLoading.indexOf(n.id)>-1,class:"admin-secondary-button px-3.5 py-1.5",onClick:u=>s.couponModal.openModal("edit",n)}," 編輯 ",8,De),e("button",{type:"button",disabled:t.couponLoading.indexOf(n.id)>-1,class:"admin-delete-button px-3.5 py-1.5",onClick:u=>s.deleteModal.openModal("優惠券",n)}," 刪除 ",8,Ee)])]))),128))])])]),g(a,{class:"mt-8","page-obj":t.pagination,onEmitPage:i.getCoupons},null,8,["page-obj","onEmitPage"])]),g(T,{ref:"couponModal",page:t.pagination.current_page,onUpdateCoupons:i.getCoupons},null,8,["page","onUpdateCoupons"]),g(D,{ref:"deleteModal",page:t.pagination.current_page,onUpdateCoupons:i.getCoupons},null,8,["page","onUpdateCoupons"])],64)}const Se=k(pe,[["render",Le]]);export{Se as default};
