import{P as E,D as T}from"./DeleteModal-962262e1.js";import{M as V}from"./index-9908806f.js";import{a as f,l as _,_ as b,o as p,c as h,b as e,i,x,v as d,u as D,t as m,F as g,g as I,d as v,r as u,j as P,f as U}from"./index-e2835f32.js";import{s as y}from"./swal-e4da1902.js";const{VITE_RENDER_API:A}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"metaverspace",VITE_RENDER_API:"https://metarverspace-server.onrender.com",BASE_URL:"/MetaverSpace/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},C={mixins:[y],data(){return{tempReserve:{},dateTime:""}},methods:{openModal(r){this.tempReserve={...r},this.dateTime=new Date(r.reserve_time).toLocaleString("zh-TW",{hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/\//g,"-").replace(" ","T"),this.reserveModal.show()},updateReserve(){this.loadings.fullLoading=!0,this.$http.put(`${A}/reserves/${this.tempReserve.id}`,{...this.tempReserve}).then(()=>{this.$emit("updateReserves",this.page,"update"),this.reserveModal.hide()}).catch(r=>{this.adminToast("error",r.message)})}},watch:{dateTime(){this.tempReserve.reserve_time=Date.parse(this.dateTime)}},computed:{...f(_,["loadings"])},mounted(){const r={placement:"center",backdrop:"static",backdropClasses:"bg-black bg-opacity-80 fixed inset-0 z-30",closable:!0};this.reserveModal=new V(this.$refs.reserveModal,r)}},S={ref:"reserveModal",id:"reserveModal",tabindex:"-1",class:"hidden fixed z-40 w-full px-4 overflow-x-hidden overflow-y-auto top-28 left-0 right-0 h-auto"},L={class:"w-full max-w-4xl h-full max-h-[calc(100vh-8.5rem)]"},B={class:"bg-white shadow rounded-lg overflow-hidden"},N={class:"flex items-start justify-between p-4 border-b bg-black top-[6rem] w-[calc(100%-2rem)] max-w-4xl z-50 rounded-t-lg fixed"},j=e("h3",{class:"text-xl font-semibold text-gray-300"},"編輯文章",-1),z=e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1),q=[z],O={class:"p-6 mt-12"},F={class:"w-full max-w-xl mx-auto space-y-6"},$=e("label",{for:"modalDistrict",class:"block mb-2 text-md font-medium text-gray-900"},"預約門市",-1),H=e("option",{value:"台北館"},"台北館",-1),W=e("option",{value:"台中館"},"台中館",-1),G=e("option",{value:"高雄館"},"高雄館",-1),J=[H,W,G],K={class:"grid grid-cols-3 gap-6"},Q={class:"col-span-2"},X=e("label",{for:"time",class:"block mb-2 font-medium"},"預約時間",-1),Y=e("label",{for:"num",class:"block mb-2 font-medium"},"人數",-1),Z=e("label",{for:"name",class:"block mb-2 font-medium"},"預約人姓名",-1),ee=e("label",{for:"phone",class:"block mb-2 font-medium"},"預約人電話",-1),te=e("label",{for:"email",class:"block mb-2 font-medium"},"預約人Email",-1),se=e("label",{for:"confirm",class:"block mb-2 font-medium"},"預約人備註",-1),oe={class:"flex justify-between items-center"},re={class:"flex"},le={class:"relative inline-flex items-center cursor-pointer"},ie=["checked"],ne=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-teal-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-600"},null,-1),ae={class:"ml-3 text-md font-medium text-gray-900"},de={class:"flex justify-end"},ce=["disabled","title"];function pe(r,s,n,c,t,a){return p(),h("div",S,[e("div",L,[e("div",B,[e("div",N,[j,e("button",{type:"button",class:"text-gray-400 bg-transparent hover:bg-gray-600 hover:text-white rounded-lg text-sm p-1.5 ml-auto inline-flex items-center",onClick:s[0]||(s[0]=o=>r.reserveModal.hide())},q)]),e("div",O,[e("div",F,[e("div",null,[$,i(e("select",{id:"modalDistrict",class:"w-40 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 block p-2.5","onUpdate:modelValue":s[1]||(s[1]=o=>t.tempReserve.title=o)},J,512),[[x,t.tempReserve.title]])]),e("div",K,[e("div",Q,[X,i(e("input",{type:"datetime-local",id:"time",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 w-full p-2.5",required:"",onkeypress:"return false","onUpdate:modelValue":s[2]||(s[2]=o=>t.dateTime=o)},null,512),[[d,t.dateTime]])]),e("div",null,[Y,i(e("input",{type:"number",id:"num",class:"text-end bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 w-full p-2.5",required:"","onUpdate:modelValue":s[3]||(s[3]=o=>t.tempReserve.num=o),onChange:s[4]||(s[4]=o=>t.tempReserve.num<1?t.tempReserve.num=1:!0)},null,544),[[d,t.tempReserve.num]])])]),e("div",null,[Z,i(e("input",{type:"text",id:"name",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 w-full p-2.5",required:"","onUpdate:modelValue":s[5]||(s[5]=o=>t.tempReserve.name=o)},null,512),[[d,t.tempReserve.name]])]),e("div",null,[ee,i(e("input",{type:"tel",id:"phone",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 w-full p-2.5",required:"","onUpdate:modelValue":s[6]||(s[6]=o=>t.tempReserve.tel=o)},null,512),[[d,t.tempReserve.tel]])]),e("div",null,[te,i(e("input",{type:"email",id:"email",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 w-full p-2.5",required:"","onUpdate:modelValue":s[7]||(s[7]=o=>t.tempReserve.email=o)},null,512),[[d,t.tempReserve.email]])]),e("div",null,[se,i(e("textarea",{id:"confirm",rows:"4",class:"block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-teal-500 focus:border-teal-500","onUpdate:modelValue":s[8]||(s[8]=o=>t.tempReserve.message=o)},null,512),[[d,t.tempReserve.message]])]),e("div",oe,[e("div",re,[e("label",le,[i(e("input",{type:"checkbox",class:"sr-only peer",checked:t.tempReserve.is_reserve,"onUpdate:modelValue":s[9]||(s[9]=o=>t.tempReserve.is_reserve=o)},null,8,ie),[[D,t.tempReserve.is_reserve]]),ne,e("span",ae,m(t.tempReserve.is_reserve?"預約成功":"尚未確認"),1)])]),e("div",de,[e("button",{type:"button",class:"admin-delete-button",onClick:s[10]||(s[10]=o=>r.reserveModal.hide())}," 取消 "),e("button",{type:"button",class:"ml-6 admin-primary-button",disabled:!t.tempReserve.reserve_time||!t.tempReserve.num||!t.tempReserve.name||!t.tempReserve.tel||!t.tempReserve.email,title:[!t.tempReserve.reserve_time||!t.tempReserve.num||!t.tempReserve.name||!t.tempReserve.tel||!t.tempReserve.email?'"*"號為必填欄位':""],onClick:s[11]||(s[11]=o=>a.updateReserve())}," 確認 ",8,ce)])])])])])])],512)}const me=b(C,[["render",pe]]),{VITE_RENDER_API:ue}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"metaverspace",VITE_RENDER_API:"https://metarverspace-server.onrender.com",BASE_URL:"/MetaverSpace/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},he={mixins:[y],data(){return{allReserves:[],reserves:[],pagination:{},titleBranch:""}},methods:{getReserves(r=1,s){this.loadings.fullLoading=!0,this.$http.get(`${ue}/reserves`).then(n=>{this.allReserves=n.data.sort((c,t)=>t.id-c.id),this.filterReserves(r),this.loadings.fullLoading=!1,s==="update"?this.adminToast("success","已更新預約資料"):s==="delete"&&this.adminToast("success","已刪除預約資料")}).catch(n=>{this.loadings.fullLoading=!1,this.userToast("error",n.message)})},filterReserves(r=1){this.reserves=this.allReserves.filter(n=>!this.titleBranch||n.title===this.titleBranch).filter((n,c)=>Math.ceil((c+1)/10)===r);const s=Math.ceil(this.allReserves.length/10);this.pagination={total_pages:s,current_page:r,has_pre:r!==1,has_next:r!==s},window.scrollTo({top:0,behavior:"smooth"})}},computed:{...f(_,["loadings"])},mounted(){this.reserveModal=this.$refs.reserveModal,this.deleteModal=this.$refs.deleteModal,this.getReserves()},components:{Pagination:E,ReserveModal:me,DeleteModal:T}},ve={class:"mt-8 px-6"},ge=e("label",{for:"district",class:"block mb-2 text-md font-medium text-gray-900"},"請選擇門市",-1),fe=e("option",{selected:"",value:""},"全部門市",-1),_e=e("option",{value:"台北館"},"台北館",-1),be=e("option",{value:"台中館"},"台中館",-1),xe=e("option",{value:"高雄館"},"高雄館",-1),ye=[fe,_e,be,xe],we={class:"mt-6 relative overflow-x-auto shadow-md sm:rounded-lg"},Re={class:"w-full text-md text-left text-gray-700"},Me=e("thead",{class:"text-sm text-dark uppercase bg-gray-300"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"預約人"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"預約時間"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"人數"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"備註"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"預約狀況"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},[e("span",{class:"sr-only"},"選項")])])],-1),ke={class:"bg-white border-b hover:bg-teal-100"},Ee={class:"px-6 py-4 whitespace-nowrap"},Te={class:"px-6 py-4 whitespace-nowrap"},Ve={class:"px-6 py-4 whitespace-nowrap"},De={class:"px-6 py-4 whitespace-nowrap"},Ie={class:"px-6 py-4 whitespace-nowrap"},Pe={class:"px-6 py-4 whitespace-nowrap flex justify-center space-x-6"},Ue=["onClick"],Ae=["onClick"];function Ce(r,s,n,c,t,a){const o=u("FontAwesomeIcon"),w=u("Pagination"),R=u("ReserveModal"),M=u("DeleteModal");return p(),h(g,null,[e("div",ve,[ge,i(e("select",{id:"district",class:"w-40 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 block p-2.5","onUpdate:modelValue":s[0]||(s[0]=l=>t.titleBranch=l),onChange:s[1]||(s[1]=l=>a.filterReserves(1))},ye,544),[[x,t.titleBranch]]),e("div",we,[e("table",Re,[Me,(p(!0),h(g,null,I(t.reserves,l=>(p(),h("tbody",{key:l.id},[e("tr",ke,[e("td",Ee,m(l.name),1),e("td",Te,m(new Date(l.reserve_time).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/(上午|下午)/,"$1 ")),1),e("td",Ve,m(l.num),1),e("td",De,[l.message?(p(),P(o,{key:0,icon:["fas","check"],class:"ml-1"})):U("",!0)]),e("td",Ie,m(l.is_reserve?"預約成功":"尚未確認"),1),e("td",Pe,[e("button",{type:"button",class:"admin-secondary-button px-3.5 py-1.5",onClick:k=>r.reserveModal.openModal(l)}," 編輯 ",8,Ue),e("button",{type:"button",class:"admin-delete-button px-3.5 py-1.5",onClick:k=>r.deleteModal.openModal("預約",l)}," 刪除 ",8,Ae)])])]))),128))])]),v(w,{class:"mt-8","page-obj":t.pagination,onEmitPage:a.filterReserves},null,8,["page-obj","onEmitPage"])]),v(R,{ref:"reserveModal",page:t.pagination.current_page,onUpdateReserves:a.getReserves},null,8,["page","onUpdateReserves"]),v(M,{ref:"deleteModal",page:t.reserves.length>1?t.pagination.current_page:t.pagination.current_page-1,onUpdateReserves:a.getReserves},null,8,["page","onUpdateReserves"])],64)}const je=b(he,[["render",Ce]]);export{je as default};
