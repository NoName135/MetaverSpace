import{P as T,D as C}from"./DeleteModal-61a9b743.js";import{M as U}from"./index-9908806f.js";import{a as f,l as b,_,o as p,c as h,b as e,i,y as x,v as d,u as V,t as m,F as v,g as D,d as g,r as u,j as L,f as B}from"./index-48565484.js";import{s as y}from"./swal-e4da1902.js";const j={mixins:[y],data(){return{tempReserve:{},dateTime:""}},methods:{openModal(r){this.tempReserve={...r},this.dateTime=new Date(r.reserve_time).toLocaleString("zh-TW",{hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/\//g,"-").replace(" ","T"),this.reserveModal.show()},updateReserve(){this.loadings.fullLoading=!0,this.$http.put(`https://metarverspace-server.onrender.com/reserves/${this.tempReserve.id}`,{...this.tempReserve}).then(()=>{this.$emit("updateReserves",this.page,"update"),this.reserveModal.hide()}).catch(r=>{this.adminToast("error",r.message)})}},watch:{dateTime(){this.tempReserve.reserve_time=Date.parse(this.dateTime)}},computed:{...f(b,["loadings"])},mounted(){const r={placement:"center",backdrop:"static",backdropClasses:"bg-black bg-opacity-80 fixed inset-0 z-30",closable:!0};this.reserveModal=new U(this.$refs.reserveModal,r)}},P={ref:"reserveModal",id:"reserveModal",tabindex:"-1",class:"hidden fixed z-40 w-full px-4 overflow-x-hidden overflow-y-auto top-28 left-0 right-0 h-auto"},z={class:"w-full max-w-4xl h-full max-h-[calc(100vh-8.5rem)]"},S={class:"bg-white shadow rounded-lg overflow-hidden"},q={class:"flex items-start justify-between p-4 border-b bg-black top-[6rem] w-[calc(100%-2rem)] max-w-4xl z-50 rounded-t-lg fixed"},E=e("h3",{class:"text-xl font-semibold text-gray-300"},"編輯文章",-1),N=e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1),F=[N],W={class:"p-6 mt-12"},O={class:"w-full max-w-xl mx-auto space-y-6"},$=e("label",{for:"modalDistrict",class:"block mb-2 text-md font-medium text-gray-900"},"預約門市",-1),A=e("option",{value:"台北館"},"台北館",-1),G=e("option",{value:"台中館"},"台中館",-1),H=e("option",{value:"高雄館"},"高雄館",-1),I=[A,G,H],J={class:"grid grid-cols-3 gap-6"},K={class:"col-span-2"},Q=e("label",{for:"time",class:"block mb-2 font-medium"},"預約時間",-1),X=e("label",{for:"num",class:"block mb-2 font-medium"},"人數",-1),Y=e("label",{for:"name",class:"block mb-2 font-medium"},"預約人姓名",-1),Z=e("label",{for:"phone",class:"block mb-2 font-medium"},"預約人電話",-1),ee=e("label",{for:"email",class:"block mb-2 font-medium"},"預約人Email",-1),te=e("label",{for:"confirm",class:"block mb-2 font-medium"},"預約人備註",-1),se={class:"flex justify-between items-center"},oe={class:"flex"},re={class:"relative inline-flex items-center cursor-pointer"},le=["checked"],ie=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-teal-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-600"},null,-1),ne={class:"ml-3 text-md font-medium text-gray-900"},ae={class:"flex justify-end"},de=["disabled","title"];function ce(r,s,n,c,t,a){return p(),h("div",P,[e("div",z,[e("div",S,[e("div",q,[E,e("button",{type:"button",class:"text-gray-400 bg-transparent hover:bg-gray-600 hover:text-white rounded-lg text-sm p-1.5 ml-auto inline-flex items-center",onClick:s[0]||(s[0]=o=>r.reserveModal.hide())},F)]),e("div",W,[e("div",O,[e("div",null,[$,i(e("select",{id:"modalDistrict",class:"w-40 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 block p-2.5","onUpdate:modelValue":s[1]||(s[1]=o=>t.tempReserve.title=o)},I,512),[[x,t.tempReserve.title]])]),e("div",J,[e("div",K,[Q,i(e("input",{type:"datetime-local",id:"time",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 w-full p-2.5",required:"",onkeypress:"return false","onUpdate:modelValue":s[2]||(s[2]=o=>t.dateTime=o)},null,512),[[d,t.dateTime]])]),e("div",null,[X,i(e("input",{type:"number",id:"num",class:"text-end bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 w-full p-2.5",required:"","onUpdate:modelValue":s[3]||(s[3]=o=>t.tempReserve.num=o),onChange:s[4]||(s[4]=o=>t.tempReserve.num<1?t.tempReserve.num=1:!0)},null,544),[[d,t.tempReserve.num]])])]),e("div",null,[Y,i(e("input",{type:"text",id:"name",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 w-full p-2.5",required:"","onUpdate:modelValue":s[5]||(s[5]=o=>t.tempReserve.name=o)},null,512),[[d,t.tempReserve.name]])]),e("div",null,[Z,i(e("input",{type:"tel",id:"phone",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 w-full p-2.5",required:"","onUpdate:modelValue":s[6]||(s[6]=o=>t.tempReserve.tel=o)},null,512),[[d,t.tempReserve.tel]])]),e("div",null,[ee,i(e("input",{type:"email",id:"email",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 w-full p-2.5",required:"","onUpdate:modelValue":s[7]||(s[7]=o=>t.tempReserve.email=o)},null,512),[[d,t.tempReserve.email]])]),e("div",null,[te,i(e("textarea",{id:"confirm",rows:"4",class:"block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-teal-500 focus:border-teal-500","onUpdate:modelValue":s[8]||(s[8]=o=>t.tempReserve.message=o)},null,512),[[d,t.tempReserve.message]])]),e("div",se,[e("div",oe,[e("label",re,[i(e("input",{type:"checkbox",class:"sr-only peer",checked:t.tempReserve.is_reserve,"onUpdate:modelValue":s[9]||(s[9]=o=>t.tempReserve.is_reserve=o)},null,8,le),[[V,t.tempReserve.is_reserve]]),ie,e("span",ne,m(t.tempReserve.is_reserve?"預約成功":"尚未確認"),1)])]),e("div",ae,[e("button",{type:"button",class:"admin-delete-button",onClick:s[10]||(s[10]=o=>this.reserveModal.hide())}," 取消 "),e("button",{type:"button",class:"ml-6 admin-primary-button",disabled:!t.tempReserve.reserve_time||!t.tempReserve.num||!t.tempReserve.name||!t.tempReserve.tel||!t.tempReserve.email,title:[!t.tempReserve.reserve_time||!t.tempReserve.num||!t.tempReserve.name||!t.tempReserve.tel||!t.tempReserve.email?'"*"號為必填欄位':""],onClick:s[11]||(s[11]=o=>a.updateReserve())}," 確認 ",8,de)])])])])])])],512)}const pe=_(j,[["render",ce]]),me={mixins:[y],data(){return{allReserves:[],reserves:[],pagination:{},titleBranch:""}},methods:{getReserves(r=1,s){this.loadings.fullLoading=!0,this.$http.get("https://metarverspace-server.onrender.com/reserves").then(n=>{this.allReserves=n.data.sort((c,t)=>t.id-c.id),this.filterReserves(r),this.loadings.fullLoading=!1,s==="update"?this.adminToast("success","已更新預約資料"):s==="delete"&&this.adminToast("success","已刪除預約資料")}).catch(n=>{this.loadings.fullLoading=!1,this.userToast("error",n.message)})},filterReserves(r=1){this.reserves=this.allReserves.filter(n=>!this.titleBranch||n.title===this.titleBranch).filter((n,c)=>Math.ceil((c+1)/10)==r);const s=Math.ceil(this.allReserves.length/10);this.pagination={total_pages:s,current_page:r,has_pre:r!==1,has_next:r!==s},window.scrollTo({top:0,behavior:"smooth"})}},computed:{...f(b,["loadings"])},mounted(){this.reserveModal=this.$refs.reserveModal,this.deleteModal=this.$refs.deleteModal,this.getReserves()},components:{Pagination:T,ReserveModal:pe,DeleteModal:C}},ue={class:"mt-8 px-6"},he=e("label",{for:"district",class:"block mb-2 text-md font-medium text-gray-900"},"請選擇門市",-1),ge=e("option",{selected:"",value:""},"全部門市",-1),ve=e("option",{value:"台北館"},"台北館",-1),fe=e("option",{value:"台中館"},"台中館",-1),be=e("option",{value:"高雄館"},"高雄館",-1),_e=[ge,ve,fe,be],xe={class:"mt-6 relative overflow-x-auto shadow-md sm:rounded-lg"},ye={class:"w-full text-md text-left text-gray-700"},we=e("thead",{class:"text-sm text-dark uppercase bg-gray-300"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"預約人"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"預約時間"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"人數"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"備註"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"預約狀況"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},[e("span",{class:"sr-only"},"選項")])])],-1),Re={class:"bg-white border-b hover:bg-teal-100"},ke={class:"px-6 py-4 whitespace-nowrap"},Me={class:"px-6 py-4 whitespace-nowrap"},Te={class:"px-6 py-4 whitespace-nowrap"},Ce={class:"px-6 py-4 whitespace-nowrap"},Ue={class:"px-6 py-4 whitespace-nowrap"},Ve={class:"px-6 py-4 whitespace-nowrap flex justify-center space-x-6"},De=["onClick"],Le=["onClick"];function Be(r,s,n,c,t,a){const o=u("font-awesome-icon"),w=u("Pagination"),R=u("ReserveModal"),k=u("DeleteModal");return p(),h(v,null,[e("div",ue,[he,i(e("select",{id:"district",class:"w-40 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 block p-2.5","onUpdate:modelValue":s[0]||(s[0]=l=>t.titleBranch=l),onChange:s[1]||(s[1]=l=>a.filterReserves(1))},_e,544),[[x,t.titleBranch]]),e("div",xe,[e("table",ye,[we,(p(!0),h(v,null,D(t.reserves,l=>(p(),h("tbody",{key:l.id},[e("tr",Re,[e("td",ke,m(l.name),1),e("td",Me,m(new Date(l.reserve_time).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/(上午|下午)/,"$1 ")),1),e("td",Te,m(l.num),1),e("td",Ce,[l.message?(p(),L(o,{key:0,icon:["fas","check"],class:"ml-1"})):B("",!0)]),e("td",Ue,m(l.is_reserve?"預約成功":"尚未確認"),1),e("td",Ve,[e("button",{type:"button",class:"admin-secondary-button px-3.5 py-1.5",onClick:M=>r.reserveModal.openModal(l)}," 編輯 ",8,De),e("button",{type:"button",class:"admin-delete-button px-3.5 py-1.5",onClick:M=>r.deleteModal.openModal("預約",l)}," 刪除 ",8,Le)])])]))),128))])]),g(w,{class:"mt-8","page-obj":t.pagination,onEmitPage:a.filterReserves},null,8,["page-obj","onEmitPage"])]),g(R,{ref:"reserveModal",page:t.pagination.current_page,onUpdateReserves:a.getReserves},null,8,["page","onUpdateReserves"]),g(k,{ref:"deleteModal",page:t.reserves.length>1?t.pagination.current_page:t.pagination.current_page-1,onUpdateReserves:a.getReserves},null,8,["page","onUpdateReserves"])],64)}const qe=_(me,[["render",Be]]);export{qe as default};
