import{P as D,D as S}from"./DeleteModal-2f0712ec.js";import{C as O,U as j}from"./ckeditor-70b63f4d.js";import{M as z}from"./index-9908806f.js";import{a as P,l as T,_ as I,r as m,o as a,c as r,b as e,i as u,v as b,f as g,t as h,d,w as L,g as M,F as V,h as E,x as U,n as B}from"./index-0de87120.js";import{s as $}from"./swal-3e866175.js";const{VITE_API:y,VITE_PATH:v}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"metaverspace",BASE_URL:"/MetaverSpace",MODE:"production",DEV:!1,PROD:!0,SSR:!1},N={props:["page"],mixins:[$],data(){return{isNew:!0,tempArticle:[],editor:O,editorConfig:{toolbar:["heading","bold","italic","|","undo","redo","|","numberedList","bulletedList","|","link"]},content:"預設文章摘要",description:"預設詳細內容",tag:[]}},methods:{openModal(o,s){o==="new"?(this.isNew=!0,this.tempArticle={create_at:Date.now()/1e3,tag:[],isPublic:!1},this.articleModal.show()):(this.isNew=!1,this.loadings.fullLoading=!0,this.$http.get(`${y}/api/${v}/admin/article/${s}`).then(n=>{const p=n.data.article;this.tempArticle.tag?this.tempArticle={...p}:this.tempArticle={...p,tag:[]},this.articleModal.show(),this.loadings.fullLoading=!1}).catch(n=>{this.loadings.fullLoading=!1,this.adminToast("error",n.response.data.message)})),this.$refs.articleModal.scrollTop=0},updateArticle(){let o="post",s=`${y}/api/${v}/admin/article`;this.isNew||(o="put",s=`${y}/api/${v}/admin/article/${this.tempArticle.id}`),this.loadings.fullLoading=!0,this.$http[o](s,{data:this.tempArticle}).then(()=>{this.$emit("updateArticles",this.page,"update"),this.articleModal.hide()}).catch(n=>{this.adminToast("error",n.response.data.message)})},changeImage(o,s,n){this.tempArticle.image=n}},computed:{...P(T,["loadings"])},mounted(){const o={placement:"center",backdrop:"static",backdropClasses:"bg-black bg-opacity-80 fixed inset-0 z-30",closable:!0};this.articleModal=new z(this.$refs.articleModal,o)},components:{UploadImg:j}},H={ref:"articleModal",id:"articleModal",tabindex:"-1",class:"hidden fixed z-40 w-full px-4 overflow-x-hidden overflow-y-auto top-28 left-0 right-0 h-auto"},R={class:"w-full max-w-7xl h-full max-h-[calc(100vh-8.5rem)]"},q={class:"bg-white shadow rounded-lg overflow-hidden"},F={class:"flex items-start justify-between p-4 border-b bg-black top-[6rem] w-[calc(100%-2rem)] lg:w-[calc(100%-3rem)] max-w-7xl z-50 rounded-t-lg fixed"},G=e("h3",{class:"text-xl font-semibold text-gray-300"},"編輯貼文",-1),J=e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1),K=[J],Q={class:"p-6 grid grid-cols-3 gap-6 mt-12"},W={class:"col-span-1"},X=e("label",{for:"name",class:"block mb-2 font-medium"},[g("發文人"),e("span",{class:"font-bold text-rose-500"},"*")],-1),Y={class:"mt-6 font-medium"},Z={class:"ml-4 text-lg font-semibold text-gray-900"},ee=e("h3",{class:"font-medium mt-6"},[g(" 主要圖片 (輸入網址或上傳圖片)"),e("span",{class:"font-bold text-rose-500"},"*")],-1),te={class:"relative mt-4"},se=e("div",{class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5 text-gray-500"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 017.843 4.582M12 3a8.997 8.997 0 00-7.843 4.582m15.686 0A11.953 11.953 0 0112 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0112 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 013 12c0-1.605.42-3.113 1.157-4.418"})])],-1),oe=e("span",null,null,-1),le=e("span",null,null,-1),ie=["src"],ne={class:"col-span-2 space-y-6"},ae=e("label",{for:"name",class:"block mb-2 font-medium"},[g("文章標題"),e("span",{class:"font-bold text-rose-500"},"*")],-1),re=e("label",{for:"tag",class:"block mb-2 font-medium"},"標籤",-1),ce={class:"grid grid-cols-5 gap-1"},de={class:"border rounded"},pe=["onUpdate:modelValue"],ue=["onClick"],me={key:0,class:""},he=e("h3",{class:"mb-2 font-medium"},"文章摘要",-1),ge=e("h3",{class:"mb-2 font-medium"},[g(" 詳細內容"),e("span",{class:"font-bold text-rose-500"},"*")],-1),fe={class:"flex justify-between items-center"},_e={class:"flex"},be={class:"relative inline-flex items-center cursor-pointer"},xe=["checked"],we=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-teal-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-600"},null,-1),ye={class:"ml-3 text-md font-medium text-gray-900"},ve={class:"flex justify-end"},Ae=["disabled","title"];function ke(o,s,n,p,t,c){var i;const x=m("UploadImg"),w=m("font-awesome-icon"),f=m("ckeditor");return a(),r("div",H,[e("div",R,[e("div",q,[e("div",F,[G,e("button",{type:"button",class:"text-gray-400 bg-transparent hover:bg-gray-600 hover:text-white rounded-lg text-sm p-1.5 ml-auto inline-flex items-center",onClick:s[0]||(s[0]=l=>o.articleModal.hide())},K)]),e("div",Q,[e("div",W,[X,u(e("input",{type:"text",id:"name",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 w-full p-2.5",required:"","onUpdate:modelValue":s[1]||(s[1]=l=>t.tempArticle.author=l)},null,512),[[b,t.tempArticle.author]]),e("h3",Y,[g(" 發文日期"),e("span",Z,h(o.$filters.date(t.tempArticle.create_at)),1)]),ee,e("div",te,[se,u(e("input",{type:"search",id:"mainImgLink",class:"block w-full p-3 pl-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-teal-500 focus:border-teal-500",placeholder:"請輸入圖片網址",required:"","onUpdate:modelValue":s[2]||(s[2]=l=>t.tempArticle.image=l)},null,512),[[b,t.tempArticle.image,void 0,{lazy:!0}]])]),d(x,{onChangeImg:c.changeImage},{multi:L(()=>[oe]),detail:L(()=>[le]),_:1},8,["onChangeImg"]),t.tempArticle.image?(a(),r("img",{key:0,src:t.tempArticle.image,class:"mt-4 w-full h-80 object-cover object-center"},null,8,ie)):M("",!0)]),e("div",ne,[e("div",null,[ae,u(e("input",{type:"text",id:"name",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-teal-500 focus:border-teal-500 w-full p-2.5",required:"","onUpdate:modelValue":s[3]||(s[3]=l=>t.tempArticle.title=l)},null,512),[[b,t.tempArticle.title]])]),e("div",null,[re,e("div",ce,[(a(!0),r(V,null,E(t.tempArticle.tag,(l,_)=>(a(),r("div",{class:"relative",key:_},[e("div",de,[u(e("input",{type:"text",class:"w-[calc(100%-1.9rem)] rounded-l-lg text-sm border-gray-300 focus:ring-violet-300",id:"tag","onUpdate:modelValue":C=>t.tempArticle.tag[_]=C,placeholder:"請輸入標籤"},null,8,pe),[[b,t.tempArticle.tag[_]]]),e("button",{type:"button",class:"absolute w-8 top-0 right-0 px-3 py-2 admin-delete-solid-button rounded-l-none rounded-r-lg border text-sm",onClick:C=>t.tempArticle.tag.splice(_,1)},[d(w,{icon:["fas","xmark"]})],8,ue)])]))),128)),!((i=t.tempArticle.tag)!=null&&i.length)||t.tempArticle.tag[t.tempArticle.tag.length-1]?(a(),r("div",me,[e("button",{type:"button",class:"admin-secondary-solid-button w-full py-2",onClick:s[4]||(s[4]=l=>t.tempArticle.tag.push(""))}," 新增標籤 ")])):M("",!0)])]),e("div",null,[he,e("div",null,[d(f,{editor:t.editor,config:t.editorConfig,modelValue:t.tempArticle.description,"onUpdate:modelValue":s[5]||(s[5]=l=>t.tempArticle.description=l)},null,8,["editor","config","modelValue"])])]),e("div",null,[ge,e("div",null,[d(f,{editor:t.editor,config:t.editorConfig,modelValue:t.tempArticle.content,"onUpdate:modelValue":s[6]||(s[6]=l=>t.tempArticle.content=l)},null,8,["editor","config","modelValue"])])]),e("div",fe,[e("div",_e,[e("label",be,[u(e("input",{type:"checkbox",class:"sr-only peer",checked:t.tempArticle.isPublic,"onUpdate:modelValue":s[7]||(s[7]=l=>t.tempArticle.isPublic=l)},null,8,xe),[[U,t.tempArticle.isPublic]]),we,e("span",ye,h(t.tempArticle.isPublic?"已發布":"未發布"),1)])]),e("div",ve,[e("button",{type:"button",class:"admin-delete-button",onClick:s[8]||(s[8]=l=>o.articleModal.hide())}," 取消 "),e("button",{type:"button",class:"ml-6 admin-primary-button",disabled:!t.tempArticle.author||!t.tempArticle.image||!t.tempArticle.title||!t.tempArticle.content,title:[!t.tempArticle.author||!t.tempArticle.image||!t.tempArticle.title||!t.tempArticle.content?'"*"號為必填欄位':""],onClick:s[9]||(s[9]=l=>c.updateArticle())}," 確認 ",8,Ae)])])])])])])],512)}const Me=I(N,[["render",ke]]);const{VITE_API:A,VITE_PATH:k}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"metaverspace",BASE_URL:"/MetaverSpace",MODE:"production",DEV:!1,PROD:!0,SSR:!1},Ve={mixins:[$],data(){return{articles:[],pagination:{},articleLoading:[]}},methods:{getArticles(o=1,s){this.loadings.fullLoading=!0,this.$http.get(`${A}/api/${k}/admin/articles?page=${o}`).then(n=>{const{articles:p,pagination:t}=n.data;this.articles=p,this.pagination=t,this.loadings.fullLoading=!1,s==="update"?this.adminToast("success","已更新貼文資料"):s==="delete"&&this.adminToast("success","已刪除貼文資料")}).catch(n=>{this.loadings.fullLoading=!1,this.adminToast("error",n.response.data.message)})},async updateEnable(o){try{this.articleLoading.push(o.id);const{data:s}=await this.$http.get(`${A}/api/${k}/admin/article/${o.id}`),n=s.article.content;await this.$http.put(`${A}/api/${k}/admin/article/${o.id}`,{data:{...o,content:n}}),this.articleLoading.shift(),this.adminToast("success","已更新發布狀態")}catch(s){this.articleLoading.shift(),this.adminToast("error",s.response.data.message),this.getArticles(this.page.current_page)}}},computed:{...P(T,["loadings"])},mounted(){this.articleModal=this.$refs.articleModal,this.deleteModal=this.$refs.deleteModal,this.getArticles()},components:{Pagination:D,ArticleModal:Me,DeleteModal:S}},Ce={class:"mt-8 px-6"},Le={class:"mt-6 relative overflow-x-auto shadow-md sm:rounded-lg"},Pe={class:"w-full text-md text-left text-gray-700"},Te=e("thead",{class:"text-sm text-dark uppercase bg-gray-300"},[e("tr",null,[e("th",{scope:"col",class:"sr-only"},"Loading"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"發布"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"發文日期"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"發文人"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},"文章標題"),e("th",{scope:"col",class:"px-6 py-3 whitespace-nowrap"},[e("span",{class:"sr-only"},"選項")])])],-1),Ie={class:"px-3 w-6 max-w-[1.5rem]"},Ee={key:0,class:"animate-spin h-5 w-5 mr-3 text-dark",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ue=e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),$e=e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1),De=[Ue,$e],Se={class:"px-6 font-medium whitespace-nowrap"},Oe={class:"w-9"},je=["disabled","checked","onUpdate:modelValue","onChange"],ze=e("div",{class:"w-full h-5 bg-gray-500 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-teal-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all border-gray-300 peer-checked:bg-teal-600"},null,-1),Be={class:"px-6 py-4 whitespace-nowrap"},Ne={class:"px-6 py-4 whitespace-nowrap"},He={class:"px-6 py-4 whitespace-nowrap"},Re={class:"px-6 py-4 whitespace-nowrap flex justify-center space-x-6"},qe=["disabled","onClick"],Fe=["disabled","onClick"];function Ge(o,s,n,p,t,c){const x=m("Pagination"),w=m("ArticleModal"),f=m("DeleteModal");return a(),r(V,null,[e("div",Ce,[e("button",{type:"button",class:"admin-primary-button",onClick:s[0]||(s[0]=i=>o.articleModal.openModal("new"))}," 新增貼文 "),e("div",Le,[e("table",Pe,[Te,e("tbody",null,[(a(!0),r(V,null,E(t.articles,i=>(a(),r("tr",{class:"bg-white border-b hover:bg-teal-100",key:i.id},[e("td",Ie,[t.articleLoading.indexOf(i.id)>-1?(a(),r("svg",Ee,De)):M("",!0)]),e("td",Se,[e("div",Oe,[e("label",{class:B(["relative",t.articleLoading.indexOf(i.id)>-1?"cursor-not-allowed":"cursor-pointer"])},[u(e("input",{type:"checkbox",class:"sr-only peer disabled:ring-4",disabled:t.articleLoading.indexOf(i.id)>-1,checked:i.isPublic,"onUpdate:modelValue":l=>i.isPublic=l,onChange:l=>c.updateEnable(i)},null,40,je),[[U,i.isPublic]]),ze],2)])]),e("td",Be,h(o.$filters.date(i.create_at)),1),e("td",Ne,h(i.author),1),e("td",He,h(i.title),1),e("td",Re,[e("button",{type:"button",disabled:t.articleLoading.indexOf(i.id)>-1,class:"admin-secondary-button px-3.5 py-1.5",onClick:l=>o.articleModal.openModal("edit",i.id)}," 編輯 ",8,qe),e("button",{type:"button",disabled:t.articleLoading.indexOf(i.id)>-1,class:"admin-delete-button px-3.5 py-1.5",onClick:l=>o.deleteModal.openModal("文章",i)}," 刪除 ",8,Fe)])]))),128))])])]),d(x,{class:"mt-8","page-obj":t.pagination,onEmitPage:c.getArticles},null,8,["page-obj","onEmitPage"])]),d(w,{ref:"articleModal",page:t.pagination.current_page,onUpdateArticles:c.getArticles},null,8,["page","onUpdateArticles"]),d(f,{ref:"deleteModal",page:t.pagination.current_page,onUpdateArticles:c.getArticles},null,8,["page","onUpdateArticles"])],64)}const Ye=I(Ve,[["render",Ge]]);export{Ye as default};
